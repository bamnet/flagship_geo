<% content_for :js_ready do %>
    var origin = new google.maps.LatLng(<%= @point.latitude %>,<%= @point.longitude %>);
    var myOptions = {
      zoom: 4,
      center: origin,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    update_fields(origin);
    
    var marker = new google.maps.Marker({
        position: origin, 
        map: map,
        draggable: true
    });
    
    google.maps.event.addListener(marker, "drag", function(){
      update_fields(marker.getPosition());
    });
    google.maps.event.addListener(marker, "dragend", function(){
      map.setCenter(marker.getPosition());
    });
<% end %>
<% content_for :js do %>
  function update_fields(latlng){
    $('#point_latitude').val(latlng.lat());
    $('#point_longitude').val(latlng.lng());
  }
<% end %>

<%= form_for(@point) do |f| %>
  <% if @point.errors.any? %>
  <div id="errorExplanation">
    <h2><%= pluralize(@point.errors.count, "error") %> prohibited this point from being saved:</h2>
    <ul>
    <% @point.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
  <% end %>

  <div class="field">
    <%= f.label :name %><br />
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <%= f.label :description %><br />
    <%= f.text_area :description %>
  </div>
  <div class="field">
    <%= f.label :latitude %><br />
    <%= f.text_field :latitude %>
  </div>
  <div class="field">
    <%= f.label :longitude %><br />
    <%= f.text_field :longitude %>
  </div>
  <%= map_canvas %>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
